# Catalyst: Order Management System

Это бэкенд-сервис для системы управления заказами, разработанный в качестве тестового задания. Приложение построено на Django и полностью контейнеризировано с помощью Docker для простоты развертывания и разработки.

## Основные возможности

*   **Аутентификация пользователей:** Регистрация пользователей и получение токена для доступа к защищенным ресурсам.
*   **Управление правами:** Администратор может назначать права доступа пользователям через стандартную админ-панель Django.
*   **Создание заказов:** Авторизованные пользователи могут создавать заказы, содержащие одного или нескольких "тикетов".
*   **Управление тикетами:** Каждый тикет имеет свой уникальный код и статус.
*   **Обновление статусов через API:** Реализован публичный эндпоинт для обновления статуса тикета, имитирующий взаимодействие с внешней системой.

## Технологический стек

*   **Бэкенд:** Python 3.12, Django, Django Rest Framework
*   **База данных:** PostgreSQL 16
*   **Фоновые задачи:** Celery, Redis 7
*   **WSGI Сервер:** Gunicorn
*   **Контейнеризация:** Docker, Docker Compose

## Архитектура проекта

Проект разработан с учетом принципов чистоты кода и разделения ответственности, изложенных в [Django Styleguide](https://github.com/HackSoftware/Django-Styleguide).

*   **Сервисы (`services.py`):** Вся бизнес-логика, которая изменяет состояние системы (создание, обновление данных), вынесена в функции-сервисы. Это делает код в API-слое "тонким" и переиспользуемым.
*   **Селекторы (`selectors.py`):** Логика получения данных из базы данных инкапсулирована в функциях-селекторах.
*   **API (`apis.py`):** Контроллеры отвечают только за обработку HTTP-запросов, валидацию входных данных через сериализаторы и вызов соответствующей бизнес-логики.
*   **Структура `src`:** Весь исходный код проекта находится внутри директории `src` для четкого отделения логики приложения от конфигурационных файлов.

## Быстрый старт

Для запуска проекта на локальной машине необходимы установленные **Docker** и **Docker Compose**.

**1. Конфигурация**

Перед запуском необходимо создать файл с переменными окружения.

```bash
# Скопируйте файл-пример в .env
cp .env.example .env
```
**Важно:** Откройте созданный файл `.env` и замените значение `SECRET_KEY` на свою уникальную секретную строку.

**2. Запуск проекта**

Выполните одну команду из корневой директории проекта:

```bash
docker-compose up --build -d
```
Эта команда соберет Docker-образы, запустит все необходимые сервисы (приложение, базу данных, Redis, Celery) и применит миграции.

**3. Создание суперпользователя**

Чтобы получить доступ к админ-панели Django, создайте суперпользователя:
```bash
docker-compose exec app python src/manage.py createsuperuser
```
Следуйте инструкциям в консоли, чтобы задать логин, email и пароль.

## Структура проекта

Весь основной код находится в директории `src/`.

```
src/
├── config/           # Глобальная конфигурация проекта (settings, urls, wsgi)
├── core/             # Общее приложение (базовые модели и т.д.)
├── users/            # Приложение для управления пользователями и аутентификацией
├── orders/           # Приложение для управления заказами и тикетами
└── manage.py         # Утилита для управления Django
```

## API Эндпоинты

Приложение доступно по адресу `http://localhost:8080`.

#### 1. Регистрация нового пользователя

*   **Method:** `POST`
*   **URL:** `/api/users/register/`
*   **Auth:** Публичный доступ
*   **Body (JSON):**
    ```json
    {
        "email": "testuser@example.com",
        "password": "yourstrongpassword"
    }
    ```
*   **Пример `curl`:**
    ```bash
    curl -X POST http://localhost:8080/api/users/register/ \
    -H "Content-Type: application/json" \
    -d '{"email": "testuser@example.com", "password": "yourstrongpassword"}'
    ```
*   **Ответ:** JSON с токеном аутентификации, который нужно использовать для следующих запросов.
    ```json
    {"token": "a1b2c3d4e5f6..."}
    ```

#### 2. Создание нового заказа

*   **Method:** `POST`
*   **URL:** `/api/orders/create/`
*   **Auth:** Требуется токен (`Authorization: Token <ВАШ_ТОКЕН>`)
*   **Body (JSON):**
    ```json
    {
        "customer_name": "John Doe",
        "customer_phone": "+1234567890",
        "tickets": [
            {"product_codes": ["PROD-A1", "PROD-B2"]},
            {"product_codes": ["PROD-C3"]}
        ]
    }
    ```
*   **Пример `curl`:**
    ```bash
    curl -X POST http://localhost:8080/api/orders/create/ \
    -H "Content-Type: application/json" \
    -H "Authorization: Token <ВАШ_ТОКЕН>" \
    -d '{"customer_name": "John Doe", "customer_phone": "+1234567890", "tickets": [{"product_codes": ["PROD-A1"]}]}'
    ```

#### 3. Обновление статуса тикета

*   **Method:** `POST`
*   **URL:** `/api/orders/tickets/<ticket_code>/update-status/`
*   **Auth:** Публичный доступ
*   **Body (JSON):**
    ```json
    {
        "status": "IN_PROGRESS"
    }
    ```
*   **Пример `curl`:**
    ```bash
    # Замените <UUID_ТИКЕТА> на реальный код тикета из админки
    curl -X POST http://localhost:8080/api/orders/tickets/<UUID_ТИКЕТА>/update-status/ \
    -H "Content-Type: application/json" \
    -d '{"status": "IN_PROGRESS"}'
    ```

## Тестирование

После запуска проекта вы можете протестировать его функциональность, используя `curl` (или любой другой API-клиент) для вызова эндпоинтов, описанных выше.

Также вы можете войти в админ-панель Django по адресу **`http://localhost:8080/admin/`**, чтобы визуально проверить созданные объекты, управлять пользователями и их правами.